# WaypointTp（PaperMC 1.21+）

**座標の保存・GUI でのテレポート・2段階削除**ができる Paper プラグイン（Kotlin）。  
オプションで、参加中/参加時の**全プレイヤーのホットバー左端（スロット0）**に**メニュー起動アイテム（オープナー）**を自動配布し、**右クリックで GUI** を開けます。

---

## 主な機能

- **インベントリ GUI** から一覧/テレポート
- **現在地の保存**（コマンド `/wp set` または GUI の「追加」）
- **金床リネーム（ゴースト入力）**：GUI の「📍 現在地を登録」を押すと**金床の入力画面**が開き、**任意の名前**で保存できます。  
  この金床は **入力専用（ゴースト）** で、置いた紙は**手元に残りません**（入力スロットへのクリック/ドラッグ/シフト・数字キー移動を禁止し、閉じる際に上段インベントリをクリア）。
- **ページング**：1ページ **45件** 表示。下段の **◀ 前へ(スロット45) / 📍 追加(スロット49) / ▶ 次へ(スロット53)** で操作できます。タイトルに **`Waypoints (現在/合計)`** を表示。
- **2段階削除**（右クリックで保留 → 10秒以内に再右クリックで確定）
- **（任意）ホットバー0番に起動アイテム**を自動配布（右クリックで GUI を開く）
- **メッセージの日本語化**：`messages.yml` によるローカライズ（Adventure/MiniMessage で装飾可能）
- **作成者表示**：GUI の各ウェイポイントアイテムの *lore* に「作成者」「座標」「ワールド」を表示
- **共有ストレージ**：ウェイポイントはサーバー側に保存され、全員で共有
- **`/wp give`**：なくした／置いてきた時に**コマンドでオープナーを再配布**（自分／他人）

---

## 動作要件

- **Paper 1.21.x**
- **Java 21 以上**（Paper 1.21 は Java 21+ 必須）

---

## 使い方（GUIでの登録）

1. `/wp ui` またはオープナー（コンパス）を右クリックして **GUI** を開く
2. 下段中央の **「📍 現在地を登録」（スロット49）** をクリック
3. **金床の入力画面**が開くので、保存したい**名前**を入力し、**右側の結果スロット**をクリック
    - この画面で使う“紙”は**持ち出せません**（ゴースト入力）。
4. 入力した名前で**現在地が保存**され、元の GUI に戻ります（キャンセル時は保存されません）

---

## コマンド

| コマンド | 説明 |
|---|---|
| `/wp ui` | GUI を開く |
| `/wp set <name> [x y z] [yaw pitch] [world]` | ウェイポイントを保存。省略した値は **現在の** x/y/z・yaw/pitch・ワールドが使われます。例：`/wp set home 100 64 -30`、`/wp set base 0 80 0 180 0 world_nether` |
| `/wp tp <name>` | 保存済み `<name>` にテレポート（非同期 `teleportAsync` を使用） |
| `/wp tpp <player>` | 指定プレイヤーの位置へテレポート |
| `/wp give [player]` | **GUI オープナー（コンパス）を配布**：引数なしで自分、指定すると他人へ |
| `/wp reload` | `messages.yml` などを再読み込み |

> **`[yaw pitch]` について**
> - **yaw** … 水平方向の角度（例：0=南、90=西、180=北、-90/270=東）
> - **pitch** … 上下方向の角度（0=水平、+90=真下、-90=真上）  
    > 省略時はコマンド実行時のプレイヤーの向きが保存されます。

---

## 権限（`plugin.yml`）

| ノード | 既定 | 役割 |
|---|---:|---|
| `waypoints.use` | `true` | `/wp` の基本利用 |
| `waypoints.create` | `true` | `/wp set` と GUI 追加 |
| `waypoints.delete` | `true` | GUI での削除 |
| `waypoints.tpp` | `true` | `/wp tpp` |
| `waypoints.opener` | `true` | `/wp give`（自分へ配布） |
| `waypoints.opener.others` | `op` | `/wp give <player>`（他人へ配布） |
| `waypoints.reload` | `op` | `/wp reload` |

---

## 実装メモ（技術）

- **GUI 識別**：`InventoryHolder` 実装の独自ホルダーで自作メニューのみを判定
- **識別情報（ID）**：アイテム／エントリに **PDC（Persistent Data Container）** で UUID を保持
- **右クリック検知**：`PlayerInteractEvent` は左右の手で発火するため、**`EquipmentSlot.HAND`（メイン手）**のみ処理
- **オープナー配布**：インベントリに空きがない場合は**足元にドロップ**して通知
- **金床入力（ゴースト化）**：上段スロット(0,1)のクリック/ドラッグ/シフト/数字キーをキャンセルし、**閉じる際に上段を `clear()`** して紙が残らないよう制御
- **ページング**：1ページ45件、**◀(45) / ＋(49) / ▶(53)** で移動・追加。タイトルに現在/総ページを表示
- **テレポート**：未ロードチャンク対策として **`teleportAsync`** を使用

---

## ビルド

このプロジェクトは **Gradle（Kotlin DSL）** を使用します。

```bash
# Windows
.\gradlew.bat clean build

# macOS/Linux
./gradlew clean build
